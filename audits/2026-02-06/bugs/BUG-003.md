# BUG-003: renameCollection Missing Input Sanitization

## Severity
MEDIUM

## Type
Security / Input Validation Gap

## Location
- File: src/services/user-storage.ts
- Line(s): 380-419
- Function: renameCollection()

## Description
The `renameCollection()` function validates the new name's length but does NOT sanitize it. Compare with `createCollection()` at line 282 which calls `sanitizeCollectionName(name)` to strip Zalgo text, invisible Unicode characters, and control characters. A user could rename a collection to inject Zalgo text or invisible characters that would persist in KV storage and be displayed in Discord embeds.

## Reproduction Scenario
1. User creates a collection with `/collection create name:MyDyes`
2. User renames it with `/collection rename name:MyDyes new_name:Z̵̧a̴̘l̸̰g̵̟o̸̜T̷̪e̵̞x̸̦t̸̘`
3. The Zalgo text is stored unsanitized in KV
4. Other users viewing the collection name in autocomplete or embeds see corrupted text

## Evidence
```typescript
// createCollection (line 282) --- SANITIZED
export async function createCollection(...) {
  const sanitizedName = sanitizeCollectionName(name);  // <- sanitized
  const sanitizedDescription = description ? sanitizeCollectionDescription(description) : undefined;
  // ...
}

// renameCollection (line 388) --- NOT SANITIZED
export async function renameCollection(...) {
  if (newName.length > MAX_COLLECTION_NAME_LENGTH) {  // <- only length check
    return { success: false, reason: 'nameTooLong' };
  }
  // ...
  collection.name = newName;  // <- raw user input stored directly
}
```

## Suggested Fix
```typescript
export async function renameCollection(
  kv: KVNamespace,
  userId: string,
  oldName: string,
  newName: string,
  logger?: ExtendedLogger
): Promise<{ success: boolean; reason?: string }> {
  try {
    // SECURITY: Sanitize new name
    const sanitizedNewName = sanitizeCollectionName(newName);

    if (!sanitizedNewName || sanitizedNewName.length === 0) {
      return { success: false, reason: 'invalidName' };
    }

    if (sanitizedNewName.length > MAX_COLLECTION_NAME_LENGTH) {
      return { success: false, reason: 'nameTooLong' };
    }
    // ... use sanitizedNewName instead of newName
  }
}
```

## Why It's Hidden
- `createCollection` is properly sanitized, giving a false sense that all paths are covered
- Rename is a less-tested code path than create
- Zalgo text issues only manifest in rendering, not in logic
