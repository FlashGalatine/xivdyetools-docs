# BUG-004: Missing Timeout on Discord Follow-Up/Edit Requests

## Severity
MEDIUM

## Type
Resource Leak / Reliability

## Location
- File: src/utils/discord-api.ts
- Line(s): 108-134, 196-221
- Functions: sendFollowUp(), editOriginalResponse()

## Description
The `sendMessage()` and `editMessage()` functions (lines 308-364) correctly include `signal: AbortSignal.timeout(5000)` to prevent worker hangs when Discord is slow. However, `sendFollowUp()` and `editOriginalResponse()` --- which are used far more frequently for deferred command responses --- have NO timeout.

If Discord's webhook endpoint is slow or unresponsive, the background task (`ctx.waitUntil`) could hang indefinitely, consuming Worker resources.

## Reproduction Scenario
1. User runs `/harmony color:#FF0000`
2. Worker defers response, processes in background
3. Background task calls `editOriginalResponse()` to send the result
4. Discord webhook endpoint is slow (e.g., during an outage)
5. The fetch call hangs with no timeout
6. Worker resources are consumed until Cloudflare kills the isolate (30s wall time limit)

## Evidence
```typescript
// sendMessage (line 321) --- HAS timeout
return fetch(url, {
  method: 'POST',
  headers: { ... },
  body: JSON.stringify(body),
  signal: AbortSignal.timeout(5000),  // <- 5s timeout
});

// sendFollowUp (line 127) --- NO timeout
return fetch(url, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(body),
  // No signal/timeout
});

// editOriginalResponse (line 214) --- NO timeout
return fetch(url, {
  method: 'PATCH',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(body),
  // No signal/timeout
});
```

## Suggested Fix
Add timeouts to all Discord API calls:

```typescript
const DISCORD_API_TIMEOUT = 10000; // 10 seconds for follow-ups (may include file uploads)

export async function sendFollowUp(...): Promise<Response> {
  // ...
  return fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body),
    signal: AbortSignal.timeout(DISCORD_API_TIMEOUT),
  });
}
```

## Why It's Hidden
- Discord is generally reliable, so timeouts rarely trigger
- Workers have a 30-second wall time limit that acts as a safety net
- The DISCORD-HIGH-002 fix was applied to `sendMessage`/`editMessage` but not to the more commonly used follow-up/edit functions
