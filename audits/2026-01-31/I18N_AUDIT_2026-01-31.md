# i18n Audit Report

**Date:** 2026-01-31
**Project:** xivdyetools-discord-worker
**Auditor:** Claude Code (Automated)

---

## Executive Summary

| Metric | Status | Details |
|--------|--------|---------|
| Missing Translations | ✅ **0** | All target locales complete |
| Untranslated Strings | ✅ **0** | No English text in non-English files |
| Translation Coverage | ✅ **100%** | All 466 keys present in all locales |
| Terminology Compliance | ✅ **Pass** | Official FFXIV terms used correctly |
| Hardcoded Strings | ⚠️ **Low Risk** | Admin-only strings found |

---

## Locale Configuration

| Property | Value |
|----------|-------|
| **Format** | Nested JSON |
| **Source Locale** | `en.json` |
| **Supported Locales** | en, ja, de, fr, ko, zh |
| **Locale Path** | `./src/locales/` |
| **i18n Framework** | Custom (Translator class in `bot-i18n.ts`) |
| **Terminology Dictionary** | `xivdyetools-core/docs/LOCALIZATION_REFERENCE.md` |

---

## Locale Status

| Locale | Keys | Line Count | Coverage | Status |
|--------|------|------------|----------|--------|
| en (source) | 466 | 616 | 100% | ✅ Complete |
| ja (Japanese) | 466 | 616 | 100% | ✅ Complete |
| de (German) | 466 | 616 | 100% | ✅ Complete |
| fr (French) | 466 | 616 | 100% | ✅ Complete |
| ko (Korean) | 466 | 616 | 100% | ✅ Complete |
| zh (Chinese) | 466 | 616 | 100% | ✅ Complete |

### Key Analysis

- **Total Keys:** 466 (leaf string values)
- **Namespaces:** meta, common, errors, quality, manual, dye, match, extractor, gradient, harmony, mixer, comparison, accessibility, favorites, collection, language, about, matchImage, buttons, matchImageHelp, preset, budget, swatch, preferences, stats, status, pagination, components, matching
- **Line Counts:** All files have exactly 616 lines - **structurally consistent**
- **Duplicate Keys:** None found (JSON keys in different nesting contexts are valid)

---

## Terminology Validation

### Core Terms (from LOCALIZATION_REFERENCE.md)

| Term | EN | JA | DE | FR | KO | ZH | Status |
|------|----|----|----|----|----|----|--------|
| Dye | Dye | カララント | Farbstoff | Teinture | 염료 | 染剂 | ✅ |
| Market Board | Market Board | マーケットボード | Marktbrett | Tableau des ventes | 마켓보드 | 市场布告板 | ✅ |

All checked translations use the official FFXIV localized terms from the terminology dictionary.

### Notable Terminology Choices

1. **Japanese "Dye" → カララント (Kararanto)**
   - Uses the English-derived "colorant" term instead of generic Japanese (染料)
   - This is the official in-game FFXIV term

2. **French "Market Board" → Tableau des ventes**
   - Literally "Sales Board" - official FFXIV French localization

3. **Chinese "Market Board" → 市场布告板**
   - Literally "Market Bulletin Board" - matches official Chinese client

---

## Hardcoded Strings Analysis

### High Priority (User-Facing)

**None found** - All user-facing command handlers properly use the translation system via `t.t()` calls.

### Medium Priority (Admin-Only)

The following hardcoded strings were found in internal/admin workflows:

| File | Line | String | Context |
|------|------|--------|---------|
| `src/index.ts` | 214 | `'Approve'` | Moderation button label |
| `src/index.ts` | 221 | `'Reject'` | Moderation button label |
| `src/index.ts` | 200 | `'Dyes'` | Embed field name (webhook) |
| `src/index.ts` | 201 | `'Tags'` | Embed field name (webhook) |
| `src/index.ts` | 239 | `'New Preset Published'` | Webhook embed title |
| `src/index.ts` | 243-246 | `'Category'`, `'Author'`, `'Source'` | Webhook embed fields |
| `src/handlers/commands/preset.ts` | 933, 940 | `'Approve'`, `'Reject'` | Moderation buttons |

**Risk Assessment:** Low
- These strings are only visible to server moderators via webhook notifications
- The moderation channel is typically admin-only
- Internationalizing these would require additional logic to determine admin locale

### Low Priority (Developer-Facing)

Test files and internal API responses contain hardcoded strings, which is expected and acceptable.

---

## Translation Quality Assessment

### Interpolation Variables

All translation keys properly use `{variable}` syntax for interpolation:
- `{name}` - dye names, collection names
- `{count}` - result counts, pagination
- `{query}` - search terms
- `{input}` - user input
- `{max}` - limits

### Pluralization

The project uses a simple approach for pluralization:
- Separate keys for singular/plural forms (e.g., `foundCount` / `foundCountPlural`)
- This works for EN/DE/FR but may need enhancement for languages with complex plural rules (e.g., Russian, Arabic)

### Context Sensitivity

Each locale file maintains consistent tone and formality:
- **German:** Uses informal "du" form (appropriate for Discord bot)
- **French:** Uses formal "vous" form
- **Korean/Japanese:** Uses polite casual forms appropriate for user-facing applications

---

## Architecture Review

### i18n System Design

The project uses a well-designed custom i18n system:

```
┌─────────────────────────────────────────────────────────────┐
│                    bot-i18n.ts                              │
├─────────────────────────────────────────────────────────────┤
│ • Static JSON imports (required for Workers)               │
│ • Translator class with fallback to English                │
│ • createUserTranslator() for user-specific locale          │
│ • Nested key access via dot notation                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     i18n.ts                                 │
├─────────────────────────────────────────────────────────────┤
│ • User preference resolution (KV storage)                  │
│ • Discord locale mapping                                   │
│ • Integration with xivdyetools-core for dye names          │
└─────────────────────────────────────────────────────────────┘
```

### Strengths

1. **Separation of concerns:** Bot UI strings vs dye name localization
2. **Automatic fallback:** Missing keys fall back to English
3. **Type safety:** Static imports enable TypeScript inference
4. **User preferences:** Respects user-set locale over Discord default

### Recommendations

1. Consider adding runtime validation for missing keys during development
2. Add automated tests to verify all locale files have the same keys
3. Create a script to detect and report untranslated strings

---

## Recommendations

### Short-Term (Optional)

1. **Add button translation keys** for moderation workflow:
   ```json
   "moderation": {
     "approve": "Approve",
     "reject": "Reject"
   }
   ```

2. **Add webhook embed translation keys** (if admin internationalization is desired):
   ```json
   "webhook": {
     "newPreset": "New Preset Published",
     "fields": {
       "category": "Category",
       "author": "Author",
       "source": "Source",
       "dyes": "Dyes",
       "tags": "Tags"
     }
   }
   ```

### Medium-Term (Recommended)

1. **Create i18n lint CI job** to verify:
   - All locale files have matching keys
   - No duplicate keys within files
   - Interpolation variables are preserved across translations

2. **Add extraction tooling:**
   ```bash
   npm run i18n:check  # Validate all locales match source
   npm run i18n:extract # Extract new keys to source locale
   ```

### Long-Term (Nice to Have)

1. Consider migration to established i18n library (e.g., `i18next`) for:
   - Proper plural rules
   - Gender agreement
   - ICU message format support

2. Set up translation management platform integration (Crowdin, Lokalise, Phrase)

---

## Maintenance Commands

```bash
# Quick validation (manual)
cd src/locales && wc -l *.json  # All should be equal

# Check for syntax errors
for f in src/locales/*.json; do python3 -m json.tool "$f" > /dev/null && echo "$f OK"; done

# Find potential hardcoded strings (heuristic)
grep -rn --include="*.ts" "title:\s*['\"]" src/handlers/
```

---

## Conclusion

The **xivdyetools-discord-worker** project has **excellent i18n coverage**:

- ✅ 100% translation coverage across all 6 supported languages
- ✅ Proper use of official FFXIV terminology
- ✅ Consistent file structure across all locales
- ✅ No missing keys or untranslated strings
- ✅ Well-designed i18n architecture with fallback support

The only minor findings are admin-facing strings in webhook notifications, which are low-risk and can be optionally internationalized in the future.

---

*Report generated by Claude Code i18n-manager skill*
